import{m as g,_ as O,o as l,c as r,e,t as o,i as v,F as u,h as f,g as T,x as V,r as p,b as m,d as $}from"./index-b5affa4f.js";import{M as w,f as k,P as I,D as x}from"./DeleteModal-7f8a36ff.js";const{VITE_URL:P,VITE_PATH:A}={VITE_URL:"https://vue3-course-api.hexschool.io/v2",VITE_PATH:"key0329",VITE_TEXT:"這是產品的環境",BASE_URL:"/2022-Vue-week7/",MODE:"production",DEV:!1,PROD:!0},D={props:{tempOrder:{type:Object,required:!0}},data(){return{bsModal:"",order:{}}},methods:{openModal(){this.bsModal.show()},closeModal(){this.bsModal.hide()},updateOrder(){const t=this.order,{id:d}=this.order;this.$http.put(`${P}/api/${A}/admin/order/${d}`,{data:t}).then(c=>{alert(c.data.message),this.$emit("get-orders"),this.closeModal()}).catch(c=>{alert(c.data.message)})},...g(k,["date","currency"])},watch:{tempOrder:{handler(t){this.order=JSON.parse(JSON.stringify(t))},deep:!0}},mounted(){this.bsModal=new w(this.$refs.orderModal)}},C={id:"orderModal",ref:"orderModal",class:"modal fade",tabindex:"-1","aria-labelledby":"orderModalLabel","aria-hidden":"true"},U={class:"modal-dialog modal-xl"},L={class:"modal-content border-0"},B=e("div",{class:"modal-header bg-dark text-white"},[e("h5",{id:"orderModalLabel",class:"modal-title"},[e("span",null,"訂單細節")]),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),R={class:"modal-body text-start"},H={class:"row"},N={class:"col-sm-4"},S=e("h2",null,"用戶資料",-1),j={class:"table"},q={key:0},F=e("th",null,"姓名",-1),G=e("th",null,"Email",-1),J=e("th",null,"電話",-1),X=e("th",null,"地址",-1),z={class:"col-sm-8"},K=e("h2",null,"訂單細節",-1),Q={class:"table"},W=e("th",null,"訂單編號",-1),Y=e("th",null,"下單時間",-1),Z=e("th",null,"付款時間",-1),ee={key:0},te={key:1},se=e("th",null,"付款狀態",-1),de={key:0,class:"text-success"},oe={key:1,class:"text-danger"},le=e("th",null,"總金額",-1),re=e("h2",null,"選購商品",-1),ne={class:"table"},ae={class:"d-flex justify-content-end"},ie={class:"form-check"},ce={class:"form-check-label",for:"orderIsPaid"},he={key:0},ue={key:1},_e={class:"modal-footer"},pe=e("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 取消 ",-1);function me(t,d,c,_,s,n){return l(),r("div",C,[e("div",U,[e("div",L,[B,e("div",R,[e("div",H,[e("div",N,[S,e("table",j,[s.order.user?(l(),r("tbody",q,[e("tr",null,[F,e("td",null,o(s.order.user.name),1)]),e("tr",null,[G,e("td",null,o(s.order.user.email),1)]),e("tr",null,[J,e("td",null,o(s.order.user.tel),1)]),e("tr",null,[X,e("td",null,o(s.order.user.address),1)])])):v("",!0)])]),e("div",z,[K,e("table",Q,[e("tbody",null,[e("tr",null,[W,e("td",null,o(s.order.id),1)]),e("tr",null,[Y,e("td",null,o(t.date(s.order.create_at)),1)]),e("tr",null,[Z,e("td",null,[s.order.paid_date?(l(),r("span",ee,o(t.date(s.order.paid_date)),1)):(l(),r("span",te,"時間不正確"))])]),e("tr",null,[se,e("td",null,[s.order.is_paid?(l(),r("span",de,"已付款")):(l(),r("span",oe,"尚未付款"))])]),e("tr",null,[le,e("td",null,o(t.currency(s.order.total)),1)])])]),re,e("table",ne,[e("tbody",null,[(l(!0),r(u,null,f(s.order.products,a=>(l(),r("tr",{key:a.id},[e("th",null,o(a.product.title),1),e("td",null,o(a.qty)+" / "+o(a.product.unit),1),e("td",null,o(t.date(a.final_total)),1)]))),128))])]),e("div",ae,[e("div",ie,[T(e("input",{class:"form-check-input",type:"checkbox",id:"orderIsPaid","onUpdate:modelValue":d[0]||(d[0]=a=>s.order.is_paid=a)},null,512),[[V,s.order.is_paid]]),e("label",ce,[s.order.is_paid?(l(),r("span",he,"已付款")):(l(),r("span",ue,"未付款"))])])])])])]),e("div",_e,[pe,e("button",{type:"button",class:"btn btn-primary",onClick:d[1]||(d[1]=(...a)=>n.updateOrder&&n.updateOrder(...a))}," 確認 ")])])])],512)}const be=O(D,[["render",me]]),{VITE_PATH:b,VITE_URL:y}={VITE_URL:"https://vue3-course-api.hexschool.io/v2",VITE_PATH:"key0329",VITE_TEXT:"這是產品的環境",BASE_URL:"/2022-Vue-week7/",MODE:"production",DEV:!1,PROD:!0},ye={components:{PaginationComponent:I,DeleteModal:x,OrderModal:be},data(){return{orders:{},tempOrder:{},isPaid:!1,pages:{},tempUrl:""}},methods:{getOrders(t,d=1){const c=this.$loading.show(),{id:_}=this.$route.params;let s=d;t||(s=parseInt(_,10)),this.$http.get(`${y}/api/${b}/admin/orders?page=${s}`).then(n=>{this.orders=n.data.orders,this.pages=n.data.pagination,this.tempUrl="/admin/orders/",c.hide()}).catch(n=>{alert(n.response.data.message)})},modelHandler(t,d){t==="editBtn"?(this.tempOrder={...d},this.$refs.orderModal.openModal()):t==="deleteBtn"&&(this.tempOrder={...d},this.$refs.delOrderModal.openModal())},deleteOrder(){const{id:t}=this.tempOrder;this.$http.delete(`${y}/api/${b}/admin/order/${t}`).then(d=>{alert(d.data.message),this.getOrders(),this.$refs.delOrderModal.closeModal()}).catch(d=>{alert(d.data.message)})},deleteAllOrders(){this.$http.delete(`${y}/api/${b}/admin/orders/all`).then(t=>{alert(t.data.message),this.getOrders(),this.$refs.delOrderModal.closeModal()}).catch(t=>{alert(t.data.message)})},...g(k,["date","currency"])},watch:{"$route.params":{handler(t){parseInt(t.id,10)===1&&this.getOrders()},deep:!0}},mounted(){this.getOrders()}},fe={class:"container py-4"},ge={class:"d-flex justify-content-end mb-2"},Oe={class:"table text-start"},ke=e("thead",null,[e("tr",null,[e("th",{width:"10%"},"購買時間"),e("th",{width:"20%"},"Email"),e("th",{width:"35%"},"購買款項"),e("th",{width:"10%"},"應付金額"),e("th",{width:"10%"},"是否付款"),e("th",{width:"15%"},"編輯")])],-1),Me={class:"list-unstyled"},Ee={class:"text-success"},ve={key:0,class:"text-success"},Te={key:1,class:"text-danger"},Ve={class:"btn-group"},$e=["onClick"],we=["onClick"],Ie={class:"d-flex justify-content-center"};function xe(t,d,c,_,s,n){const a=p("pagination-component"),M=p("order-modal"),E=p("delete-modal");return l(),r(u,null,[e("div",fe,[e("div",ge,[e("button",{type:"button",class:"btn btn-danger",onClick:d[0]||(d[0]=(...i)=>n.deleteAllOrders&&n.deleteAllOrders(...i))}," 刪除全部訂單 ")]),e("table",Oe,[ke,e("tbody",null,[(l(!0),r(u,null,f(s.orders,i=>(l(),r("tr",{key:i.id},[e("td",null,o(t.date(i.create_at)),1),e("td",null,o(i.user.email),1),e("td",null,[e("ul",Me,[(l(!0),r(u,null,f(i.products,h=>(l(),r("li",{key:h.id},[$(o(h.product.title)+" ",1),e("span",Ee,"( 數量: "+o(h.product.num)+" "+o(h.product.unit)+" )",1)]))),128))])]),e("td",null,o(t.currency(i.total)),1),e("td",null,[i.is_paid?(l(),r("span",ve,"已付款")):(l(),r("span",Te,"尚未付款"))]),e("td",null,[e("div",Ve,[e("button",{type:"button",onClick:h=>n.modelHandler("editBtn",i),class:"btn btn-outline-primary"}," 檢視 ",8,$e),e("button",{type:"button",onClick:h=>n.modelHandler("deleteBtn",i),class:"btn btn-outline-danger"}," 刪除 ",8,we)])])]))),128))])]),e("div",Ie,[m(a,{pages:s.pages,"temp-url":s.tempUrl,onEmitPage:n.getOrders},null,8,["pages","temp-url","onEmitPage"])])]),m(M,{ref:"orderModal","temp-order":s.tempOrder,onGetOrders:n.getOrders},null,8,["temp-order","onGetOrders"]),m(E,{ref:"delOrderModal","temp-item":s.tempOrder,onDeleteItem:n.deleteOrder},null,8,["temp-item","onDeleteItem"])],64)}const De=O(ye,[["render",xe]]);export{De as default};
