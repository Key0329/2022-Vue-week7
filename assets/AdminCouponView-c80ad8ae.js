import{m as v,_ as w,o as i,c,e,t as u,g as p,s as r,x as k,r as m,F as b,h as x,b as _}from"./index-b5affa4f.js";import{M as I,f as y,P as D,D as U}from"./DeleteModal-7f8a36ff.js";const{VITE_URL:f,VITE_PATH:g}={VITE_URL:"https://vue3-course-api.hexschool.io/v2",VITE_PATH:"key0329",VITE_TEXT:"這是產品的環境",BASE_URL:"/2022-Vue-week7/",MODE:"production",DEV:!1,PROD:!0},B={name:"coupon-modal",props:{isNew:{type:Boolean,required:!0},tempCoupon:{type:Object,required:!0}},data(){return{bsModal:"",coupon:{},due_date:""}},methods:{openModal(){this.bsModal.show()},closeModal(){this.bsModal.hide()},addNewCoupon(){const s=this.coupon;if(!this.coupon.title||!this.coupon.code||!this.coupon.due_date||!this.coupon.percent||!this.coupon.is_enabled){alert("標題 / 優惠碼 / 到期日 / 折扣百分比 / 請先啟用優惠券 為必填欄位");return}this.$http.post(`${f}/api/${g}/admin/coupon`,{data:s}).then(t=>{alert(t.data.message),this.$emit("get-coupons"),this.closeModal()}).catch(t=>{console.log(t),alert(t.response.data.message)})},updateCoupon(){const s=this.coupon,{id:t}=this.coupon;if(!this.coupon.title||!this.coupon.code||!this.coupon.due_date||!this.coupon.percent){alert("標題 / 優惠碼 / 到期日 / 折扣百分比 為必填欄位");return}this.$http.put(`${f}/api/${g}/admin/coupon/${t}`,{data:s}).then(a=>{alert(a.data.message),this.$emit("get-coupons"),this.closeModal()}).catch(a=>{alert(a.data.message)})},updateCouponHandler(){this.isNew?this.addNewCoupon():this.updateCoupon()},...v(y,["date"])},watch:{tempCoupon(){this.coupon=this.tempCoupon;const s=new Date(this.coupon.due_date*1e3).toISOString().split("T");[this.due_date]=s},due_date(){this.coupon.due_date=Math.floor(new Date(this.due_date)/1e3)}},mounted(){this.bsModal=new I(this.$refs.couponModal)}},H={id:"couponModal",ref:"couponModal",class:"modal fade",tabindex:"-1","aria-labelledby":"couponModalLabel","aria-hidden":"true"},N={class:"modal-dialog"},P={class:"modal-content border-0"},A={class:"modal-header bg-dark text-white"},L={id:"couponModalLabel",class:"modal-title"},R=e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),O={class:"modal-body text-start"},S={class:"mb-3"},j=e("label",{for:"title",class:"form-label"},"標題",-1),q={class:"mb-3"},F=e("label",{for:"code",class:"form-label"},"優惠碼",-1),G={class:"mb-3"},X=e("label",{for:"date",class:"form-label"},"到期日",-1),z={class:"mb-3"},J=e("label",{for:"percent",class:"form-label"},"折扣百分比",-1),K={class:"mb-3"},Q={class:"form-check"},W=e("label",{for:"coupon-is_enabled",class:"form-check-label"},"啟用",-1),Y={class:"modal-footer"},Z=e("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 取消 ",-1);function ee(s,t,a,h,o,n){return i(),c("div",H,[e("div",N,[e("div",P,[e("div",A,[e("h5",L,[e("span",null,u(a.isNew?"新增優惠券":"編輯優惠券"),1)]),R]),e("div",O,[e("div",S,[j,p(e("input",{id:"title",type:"text",class:"form-control",placeholder:"請輸入標題","onUpdate:modelValue":t[0]||(t[0]=l=>o.coupon.title=l)},null,512),[[r,o.coupon.title]])]),e("div",q,[F,p(e("input",{id:"code",type:"text",class:"form-control",placeholder:"請輸入優惠碼","onUpdate:modelValue":t[1]||(t[1]=l=>o.coupon.code=l)},null,512),[[r,o.coupon.code]])]),e("div",G,[X,p(e("input",{id:"date",type:"date",class:"form-control","onUpdate:modelValue":t[2]||(t[2]=l=>o.due_date=l)},null,512),[[r,o.due_date]])]),e("div",z,[J,p(e("input",{id:"percent",type:"number",min:"0",class:"form-control",placeholder:"請輸入折扣百分比","onUpdate:modelValue":t[3]||(t[3]=l=>o.coupon.percent=l)},null,512),[[r,o.coupon.percent,void 0,{number:!0}]])]),e("div",K,[e("div",Q,[W,p(e("input",{id:"coupon-is_enabled",type:"checkbox",class:"form-check-input","true-value":1,"false-value":0,"onUpdate:modelValue":t[4]||(t[4]=l=>o.coupon.is_enabled=l)},null,512),[[k,o.coupon.is_enabled]])])])]),e("div",Y,[Z,e("button",{type:"button",class:"btn btn-primary",onClick:t[5]||(t[5]=(...l)=>n.updateCouponHandler&&n.updateCouponHandler(...l))},u(a.isNew?"新增優惠券":"更新優惠券"),1)])])])],512)}const te=w(B,[["render",ee]]),{VITE_PATH:C,VITE_URL:M}={VITE_URL:"https://vue3-course-api.hexschool.io/v2",VITE_PATH:"key0329",VITE_TEXT:"這是產品的環境",BASE_URL:"/2022-Vue-week7/",MODE:"production",DEV:!1,PROD:!0},oe={components:{PaginationComponent:D,couponModal:te,DeleteModal:U},data(){return{coupons:{},tempCoupon:{title:"",is_enabled:0,percent:100,code:""},isNew:!1,isEnabled:!1,pages:{},tempUrl:""}},methods:{getCoupons(s,t=1){const a=this.$loading.show(),{id:h}=this.$route.params;let o=t;s||(o=parseInt(h,10)),this.$http.get(`${M}/api/${C}/admin/coupons?page=${o}`).then(n=>{this.coupons=n.data.coupons,this.pages=n.data.pagination,this.tempUrl="/admin/coupons/",a.hide()}).catch(n=>{alert(n.response.data.message)})},modelHandler(s,t){s==="createBtn"?(this.isNew=!0,this.tempCoupon={due_date:new Date().getTime()/1e3},this.$refs.couponModal.openModal()):s==="editBtn"?(this.tempCoupon={...t},this.isNew=!1,this.$refs.couponModal.openModal()):s==="deleteBtn"&&(this.tempCoupon={...t},this.$refs.delCouponModal.openModal())},deleteCoupon(){const{id:s}=this.tempCoupon;this.$http.delete(`${M}/api/${C}/admin/coupon/${s}`).then(t=>{alert(t.data.message),this.getCoupons(),this.$refs.delCouponModal.closeModal()}).catch(t=>{alert(t.data.message)})},...v(y,["date"])},mounted(){this.getCoupons()}},se={class:"container py-4"},ne={class:"d-flex justify-content-end mb-2"},le={class:"table text-start"},ae=e("thead",null,[e("tr",null,[e("th",{width:"20%"},"名稱"),e("th",{width:"20%"},"折扣百分比"),e("th",{width:"35%"},"到期日"),e("th",{width:"10%"},"是否啟用"),e("th",{width:"15%"},"編輯")])],-1),de={key:0,class:"text-success"},ie={key:1,class:"text-danger"},ce={class:"btn-group"},pe=["onClick"],ue=["onClick"],re={class:"d-flex justify-content-center"};function he(s,t,a,h,o,n){const l=m("pagination-component"),T=m("coupon-modal"),E=m("delete-modal");return i(),c(b,null,[e("div",se,[e("div",ne,[e("button",{type:"button",class:"btn btn-primary",onClick:t[0]||(t[0]=d=>n.modelHandler("createBtn"))}," 建立新優惠券 ")]),e("table",le,[ae,e("tbody",null,[(i(!0),c(b,null,x(o.coupons,(d,V)=>(i(),c("tr",{key:V},[e("td",null,u(d.title),1),e("td",null,u(d.percent)+"%",1),e("td",null,u(s.date(d.due_date)),1),e("td",null,[d.is_enabled?(i(),c("span",de,"已啟用")):(i(),c("span",ie,"未啟用"))]),e("td",null,[e("div",ce,[e("button",{type:"button",class:"btn btn-outline-primary",onClick:$=>n.modelHandler("editBtn",d)}," 編輯 ",8,pe),e("button",{type:"button",class:"btn btn-outline-danger",onClick:$=>n.modelHandler("deleteBtn",d)}," 刪除 ",8,ue)])])]))),128))])]),e("div",re,[_(l,{pages:o.pages,"temp-url":o.tempUrl,onEmitPage:n.getCoupons},null,8,["pages","temp-url","onEmitPage"])])]),_(T,{ref:"couponModal","is-new":o.isNew,"temp-coupon":o.tempCoupon,onGetCoupons:n.getCoupons},null,8,["is-new","temp-coupon","onGetCoupons"]),_(E,{ref:"delCouponModal","temp-item":o.tempCoupon,onDeleteItem:n.deleteCoupon},null,8,["temp-item","onDeleteItem"])],64)}const be=w(oe,[["render",he]]);export{be as default};
