import{_ as k,o as i,c as r,e as t,t as _,u as P,i as h,g as n,s as p,F as U,h as M,x,m as T,r as g,b as f}from"./index-fc5ec7fb.js";import{M as D,P as E,D as N,f as C}from"./DeleteModal-0fa704c7.js";const{VITE_URL:v,VITE_PATH:y}={VITE_URL:"https://vue3-course-api.hexschool.io/v2",VITE_PATH:"key0329",VITE_TEXT:"這是產品的環境",BASE_URL:"/2022-Vue-week6/",MODE:"production",DEV:!1,PROD:!0},B={name:"product-modal-component",props:{isNew:{type:Boolean,required:!0},tempProduct:{type:Object,required:!0}},data(){return{bsModal:"",product:{}}},methods:{openModal(){this.bsModal.show()},closeModal(){this.bsModal.hide()},addImage(){this.product.imagesUrl.push("")},createImage(){this.product.imagesUrl=[],this.product.imagesUrl.push("")},deleteImage(){this.product.imagesUrl.pop()},updateImage(l,e){this.product.imagesUrl[l]=e},addNewProduct(){const l=this.product;if(!this.product.title||!this.product.category||!this.product.unit||!this.product.price||!this.product.origin_price){alert("標題 / 分類 / 單位 / 原價 / 售價 為必填欄位");return}this.$http.post(`${v}/api/${y}/admin/product`,{data:l}).then(e=>{alert(e.data.message),this.$emit("get-products-data"),this.closeModal()}).catch(e=>{alert(e.data.message)})},updateProduct(){const l=this.product,{id:e}=this.product;if(!this.product.title||!this.product.category||!this.product.unit||!this.product.price||!this.product.origin_price){alert("標題 / 分類 / 單位 / 原價 / 售價 為必填欄位");return}this.$http.put(`${v}/api/${y}/admin/product/${e}`,{data:l}).then(a=>{alert(a.data.message),this.$emit("get-products-data"),this.closeModal()}).catch(a=>{alert(a.data.message)})},updateProductHandler(){this.isNew?this.addNewProduct():this.updateProduct()},handleSubmit(l,e,a){const m=new FormData(a.target);this.sendFormData(l,e,m)},sendFormData(l,e,a){this.$http.post(`${v}/api/${y}/admin/upload`,a).then(m=>{const o=m.data.imageUrl;l==="multi"?this.product.imagesUrl[e]=o:l==="main"&&(this.product.imageUrl=o)}).catch(m=>{alert(m.message)})}},watch:{tempProduct:{handler(l){this.product=JSON.parse(JSON.stringify(l))},deep:!0}},mounted(){this.bsModal=new D(this.$refs.productModal)}},H={id:"productModal",ref:"productModal",class:"modal fade",tabindex:"-1","aria-labelledby":"productModalLabel","aria-hidden":"true"},S={class:"modal-dialog modal-xl"},A={class:"modal-content border-0"},L={class:"modal-header bg-dark text-white"},F={id:"productModalLabel",class:"modal-title"},R=t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),O={class:"modal-body text-start"},q={class:"row"},G={class:"col-sm-4"},J=t("h3",{class:"mb-3"},"主要圖片",-1),X={class:"mb-3"},j={class:"mb-3"},$={key:0,class:"form-group mb-2"},z=t("label",{class:"mb-2",for:"uploadImageFile"},"上傳圖片",-1),K=t("input",{id:"uploadImageFile",class:"form-control mb-1",type:"file",name:"file-to-upload"},null,-1),Q=t("input",{class:"form-control",type:"submit",value:"確認上傳"},null,-1),W=[z,K,Q],Y={class:"form-group"},Z={key:0,for:"uploadImageUrl",class:"form-label"},tt=["src"],et=t("h3",{class:"mb-3"},"多圖新增",-1),ot={key:0},st={class:"mb-3"},lt=["onSubmit"],dt={key:0,class:"form-group mb-2"},it=t("label",{class:"mb-2",for:"uploadImagesFile"},"上傳圖片",-1),rt=t("input",{id:"uploadImagesFile",class:"form-control mb-1",type:"file",name:"file-to-upload"},null,-1),at=t("input",{class:"form-control",type:"submit",value:"確認上傳"},null,-1),nt=[it,rt,at],ct={class:"form-group"},ut={key:0,for:"uploadImagesUrl",class:"form-label"},pt=["onUpdate:modelValue"],mt=["src","alt"],ht={key:0},_t={key:1},bt={key:1},gt={class:"col-sm-8"},ft={class:"mb-3"},vt=t("label",{for:"title",class:"form-label"},"標題",-1),yt={class:"row"},Ut={class:"mb-3 col-md-6"},Pt=t("label",{for:"category",class:"form-label"},"分類",-1),wt={class:"mb-3 col-md-6"},It=t("label",{for:"price",class:"form-label"},"單位",-1),kt={class:"row"},Mt={class:"mb-3 col-md-6"},Vt=t("label",{for:"origin_price",class:"form-label"},"原價",-1),xt={class:"mb-3 col-md-6"},Tt=t("label",{for:"price",class:"form-label"},"售價",-1),Dt={class:"mb-3 col-md-6"},Et=t("label",{for:"review",class:"form-label"},"評價",-1),Nt=t("hr",null,null,-1),Ct={class:"mb-3"},Bt=t("label",{for:"description",class:"form-label"},"產品描述",-1),Ht={class:"mb-3"},St=t("label",{for:"content",class:"form-label"},"說明內容",-1),At={class:"mb-3"},Lt={class:"form-check"},Ft=t("label",{class:"form-check-label",for:"is_enabled"},"是否啟用",-1),Rt={class:"modal-footer"},Ot=t("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 取消 ",-1);function qt(l,e,a,m,o,d){return i(),r("div",H,[t("div",S,[t("div",A,[t("div",L,[t("h5",F,[t("span",null,_(a.isNew?"新增產品":"編輯產品"),1)]),R]),t("div",O,[t("div",q,[t("div",G,[J,t("div",X,[t("div",j,[t("form",{class:"mt-2",onSubmit:e[1]||(e[1]=P(s=>d.handleSubmit("main","null",s),["prevent"])),action:"https://vue3-course-api.hexschool.io/v2/api/key0329/admin/upload",enctype:"multipart/form-data",method:"post"},[o.product.imageUrl?h("",!0):(i(),r("div",$,W)),t("div",Y,[o.product.imageUrl?h("",!0):(i(),r("label",Z,"或輸入圖片網址")),n(t("input",{type:"text",id:"uploadImageUrl",class:"form-control",placeholder:"請輸入圖片連結","onUpdate:modelValue":e[0]||(e[0]=s=>o.product.imageUrl=s)},null,512),[[p,o.product.imageUrl]])])],32)]),o.product.imageUrl?(i(),r("img",{key:0,class:"img-fluid",src:o.product.imageUrl,alt:"mainImg"},null,8,tt)):h("",!0)]),et,Array.isArray(o.product.imagesUrl)?(i(),r("div",ot,[(i(!0),r(U,null,M(o.product.imagesUrl,(s,c)=>(i(),r("div",{class:"mb-4 pb-2 border-1 border-bottom",key:c},[t("div",st,[t("form",{class:"mt-2",onSubmit:P(b=>d.handleSubmit("multi",c,b),["prevent"]),action:"https://vue3-course-api.hexschool.io/v2/api/key0329/admin/upload",enctype:"multipart/form-data",method:"post"},[o.product.imagesUrl[c]?h("",!0):(i(),r("div",dt,nt)),t("div",ct,[o.product.imagesUrl[c]?h("",!0):(i(),r("label",ut,"或輸入圖片網址")),n(t("input",{type:"text",id:"uploadImagesUrl",class:"form-control",placeholder:"請輸入圖片連結","onUpdate:modelValue":b=>o.product.imagesUrl[c]=b},null,8,pt),[[p,o.product.imagesUrl[c]]])])],40,lt)]),this.product.imagesUrl[c]?(i(),r("img",{key:0,class:"img-fluid",src:s,alt:"img"+c},null,8,mt)):h("",!0)]))),128)),!o.product.imagesUrl.length||o.product.imagesUrl[o.product.imagesUrl.length-1]?(i(),r("div",ht,[t("button",{class:"btn btn-outline-primary btn-sm d-block w-100",onClick:e[2]||(e[2]=(...s)=>d.addImage&&d.addImage(...s))}," 新增圖片 ")])):(i(),r("div",_t,[t("button",{class:"btn btn-outline-danger btn-sm d-block w-100",onClick:e[3]||(e[3]=(...s)=>d.deleteImage&&d.deleteImage(...s))}," 刪除圖片 ")]))])):(i(),r("div",bt,[t("button",{class:"btn btn-outline-primary btn-sm d-block w-100",onClick:e[4]||(e[4]=(...s)=>d.createImage&&d.createImage(...s))}," 新增圖片 ")]))]),t("div",gt,[t("div",ft,[vt,n(t("input",{id:"title",type:"text",class:"form-control",placeholder:"請輸入標題","onUpdate:modelValue":e[5]||(e[5]=s=>o.product.title=s)},null,512),[[p,o.product.title]])]),t("div",yt,[t("div",Ut,[Pt,n(t("input",{id:"category",type:"text",class:"form-control",placeholder:"請輸入分類","onUpdate:modelValue":e[6]||(e[6]=s=>o.product.category=s)},null,512),[[p,o.product.category]])]),t("div",wt,[It,n(t("input",{id:"unit",type:"text",class:"form-control",placeholder:"請輸入單位","onUpdate:modelValue":e[7]||(e[7]=s=>o.product.unit=s)},null,512),[[p,o.product.unit]])])]),t("div",kt,[t("div",Mt,[Vt,n(t("input",{id:"origin_price",type:"number",min:"0",class:"form-control",placeholder:"請輸入原價","onUpdate:modelValue":e[8]||(e[8]=s=>o.product.origin_price=s)},null,512),[[p,o.product.origin_price,void 0,{number:!0}]])]),t("div",xt,[Tt,n(t("input",{id:"price",type:"number",min:"0",class:"form-control",placeholder:"請輸入售價","onUpdate:modelValue":e[9]||(e[9]=s=>o.product.price=s)},null,512),[[p,o.product.price,void 0,{number:!0}]])]),t("div",Dt,[Et,n(t("input",{id:"review",type:"number",min:"0",max:"5",class:"form-control",placeholder:"請輸入星級","onUpdate:modelValue":e[10]||(e[10]=s=>o.product.review=s)},null,512),[[p,o.product.review,void 0,{number:!0}]])])]),Nt,t("div",Ct,[Bt,n(t("textarea",{id:"description",type:"text",class:"form-control",placeholder:"請輸入產品描述","onUpdate:modelValue":e[11]||(e[11]=s=>o.product.description=s),style:{height:"100px"}},null,512),[[p,o.product.description]])]),t("div",Ht,[St,n(t("textarea",{id:"description",type:"text",class:"form-control",placeholder:"請輸入說明內容","onUpdate:modelValue":e[12]||(e[12]=s=>o.product.content=s),style:{height:"150px"}},null,512),[[p,o.product.content]])]),t("div",At,[t("div",Lt,[n(t("input",{id:"is_enabled",class:"form-check-input",type:"checkbox","true-value":1,"false-value":0,"onUpdate:modelValue":e[13]||(e[13]=s=>o.product.is_enabled=s)},null,512),[[x,o.product.is_enabled]]),Ft])])])])]),t("div",Rt,[Ot,t("button",{type:"button",class:"btn btn-primary",onClick:e[14]||(e[14]=(...s)=>d.updateProductHandler&&d.updateProductHandler(...s))}," 確認 ")])])])],512)}const Gt=k(B,[["render",qt]]),{VITE_URL:w,VITE_PATH:I}={VITE_URL:"https://vue3-course-api.hexschool.io/v2",VITE_PATH:"key0329",VITE_TEXT:"這是產品的環境",BASE_URL:"/2022-Vue-week6/",MODE:"production",DEV:!1,PROD:!0},Jt={data(){return{products:[],tempProduct:{},isNew:!1,pages:{},tempUrl:""}},components:{PaginationComponent:E,ProductModalComponent:Gt,DeleteModal:N},methods:{getProductsData(l,e=1){const a=this.$loading.show(),{id:m}=this.$route.params;let o=e;l||(o=parseInt(m,10)),this.$http.get(`${w}/api/${I}/admin/products?page=${o}`).then(d=>{this.products=d.data.products,this.pages=d.data.pagination,this.tempUrl="/admin/products/",a.hide()}).catch(d=>{alert(d.response.data.message)})},modelHandler(l,e){l==="createBtn"?(this.isNew=!0,this.tempProduct={},this.$refs.productModal.openModal()):l==="editBtn"?(this.tempProduct={...e},this.isNew=!1,this.$refs.productModal.openModal()):l==="deleteBtn"&&(this.tempProduct={...e},this.$refs.delProductModal.openModal())},deleteProduct(){const{id:l}=this.tempProduct;this.$http.delete(`${w}/api/${I}/admin/product/${l}`).then(e=>{alert(e.data.message),this.getProductsData(),this.$refs.delProductModal.closeModal()}).catch(e=>{alert(e.data.message)})},...T(C,["currency"])},watch:{"$route.params":{handler(l){parseInt(l.id,10)===1&&this.getProductsData()},deep:!0}},mounted(){this.getProductsData()}},Xt={class:"container"},jt={class:"text-end mt-4"},$t={class:"table mt-4"},zt=t("thead",null,[t("tr",null,[t("th",{width:"120"},"分類"),t("th",null,"產品名稱"),t("th",{width:"120"},"原價"),t("th",{width:"120"},"售價"),t("th",{width:"100"},"評價星級"),t("th",{width:"100"},"是否啟用"),t("th",{width:"120"},"編輯")])],-1),Kt={class:"text-start"},Qt={class:"text-start"},Wt={class:"text-center"},Yt={key:0,class:"text-success"},Zt={key:1},te={class:"btn-group"},ee=["onClick"],oe=["onClick"];function se(l,e,a,m,o,d){const s=g("pagination-component"),c=g("product-modal-component"),b=g("delete-modal");return i(),r(U,null,[t("div",Xt,[t("div",jt,[t("button",{class:"btn btn-primary",onClick:e[0]||(e[0]=u=>d.modelHandler("createBtn"))}," 建立新的產品 ")]),t("table",$t,[zt,t("tbody",null,[(i(!0),r(U,null,M(o.products,u=>(i(),r("tr",{key:u.id},[t("td",null,_(u.category),1),t("td",null,_(u.title),1),t("td",Kt,"NT$ "+_(l.currency(u.origin_price)),1),t("td",Qt,"NT$ "+_(l.currency(u.price)),1),t("td",Wt,_(u.review),1),t("td",null,[u.is_enabled?(i(),r("span",Yt,"啟用")):(i(),r("span",Zt,"未啟用"))]),t("td",null,[t("div",te,[t("button",{type:"button",class:"btn btn-outline-primary btn-sm",onClick:V=>d.modelHandler("editBtn",u)}," 編輯 ",8,ee),t("button",{type:"button",class:"btn btn-outline-danger btn-sm",onClick:V=>d.modelHandler("deleteBtn",u)}," 刪除 ",8,oe)])])]))),128))])]),f(s,{pages:o.pages,"temp-url":o.tempUrl,onEmitPage:d.getProductsData},null,8,["pages","temp-url","onEmitPage"])]),f(c,{ref:"productModal","is-new":o.isNew,"temp-product":o.tempProduct,onGetProductsData:d.getProductsData},null,8,["is-new","temp-product","onGetProductsData"]),f(b,{ref:"delProductModal","temp-item":o.tempProduct,onDeleteItem:d.deleteProduct},null,8,["temp-item","onDeleteItem"])],64)}const ie=k(Jt,[["render",se]]);export{ie as default};
